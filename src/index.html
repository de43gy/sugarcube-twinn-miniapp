<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таинственное поместье</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Modular Styles -->
    <link rel="stylesheet" href="./styles/themes/dark-theme.css">
    <link rel="stylesheet" href="./styles/components/layout.css">
    <link rel="stylesheet" href="./styles/components/passages.css">
    <link rel="stylesheet" href="./styles/components/ui.css">
</head>
<body class="bg-gray-900 text-white p-4">
    <!-- Story content will be injected here by build system -->
    <div id="passages" class="passages-container"></div>
    
    <!-- Custom Game UI -->
    <div id="game-ui">
        <h2>Инвентарь</h2>
        <div id="inventory-list">Пусто</div>
        <h2 style="margin-top: 1rem;">Локация</h2>
        <div id="location-display">Загрузка...</div>
    </div>

    <!-- External Libraries -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/sugarcube-2@2.36.1/dist/sugarcube-2.min.js"></script>

    <!-- Game Systems -->
    <script src="./scripts/core/game-data.js"></script>
    <script src="./scripts/systems/inventory.js"></script>
    <script src="./scripts/systems/location.js"></script>
    <script src="./scripts/ui/game-ui.js"></script>
    <script src="./scripts/telegram/telegram-integration.js"></script>
    <script src="./scripts/core/sugarcube-macros.js"></script>

    <!-- Initialize Game Data -->
    <script>
        // Load game data and let SugarCube handle initialization
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM loaded, initializing game...');
            
            try {
                const dataLoaded = await window.GameData.loadData();
                if (dataLoaded) {
                    console.log('Game data loaded successfully');
                    console.log('Available locations:', Object.keys(window.GameData.locations));
                } else {
                    console.error('Failed to load game data');
                }
            } catch (error) {
                console.error('Error loading game data:', error);
            }
            
            // Log when SugarCube is ready
            $(document).on(':storyready', function() {
                console.log('SugarCube story is ready!');
            });
            
            // Log passage transitions
            $(document).on(':passagestart', function(event) {
                console.log('Starting passage:', event.passage.title);
            });
            
            $(document).on(':passageend', function(event) {
                console.log('Finished passage:', event.passage.title);
            });
        });
    </script>

    <!-- Story content will be injected here by build system -->
</body>
</html>